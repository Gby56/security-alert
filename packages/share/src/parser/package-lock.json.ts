import { PackageLock } from "@npm/types";
import { DependenciesType, PackageDetails } from "./Details";

export function isPackageLock(packageFilePath: string) {
    return /package-lock.json$/.test(packageFilePath);
}

export function lookupPackageLockDetails({
    packageName,
    packageFilePath,
    pkg
}: {
    packageName: string;
    packageFilePath: string;
    pkg: PackageLock;
}): PackageDetails {
    if (!pkg.dependencies) {
        return {
            name: packageName,
            packageFilePath,
            version: "0.0.0",
            dependenciesType: "unknown"
        };
    }
    const dependency = pkg.dependencies[packageName];
    if (!dependency) {
        return {
            name: packageName,
            packageFilePath,
            version: "0.0.0",
            dependenciesType: "unknown"
        };
    }
    const type: DependenciesType = dependency.dev ? "devDependencies" : "dependencies";
    return {
        name: packageName,
        packageFilePath,
        version: dependency.version,
        dependenciesType: type
    };
}
